<!doctype html>
<html lang="id">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#0f0f1a" />
  <meta name="description"
    content="QR Scanner — Scan QR codes instantly with your camera. Fast, modern, and works offline." />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="QR Scan" />
  <link rel="icon" type="image/svg+xml" href="/qr-icon.svg" />
  <link rel="apple-touch-icon" href="/icon-192.svg" />
  <link rel="manifest" href="/manifest.json" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <title>QR Scan — Scanner</title>
</head>

<body>
  <div id="app">
    <!-- Animated Background -->
    <div class="bg-mesh">
      <div class="orb orb-1"></div>
      <div class="orb orb-2"></div>
      <div class="orb orb-3"></div>
    </div>

    <!-- Header -->
    <header class="app-header">
      <div class="header-content">
        <div class="logo">
          <svg class="logo-icon" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="2" y="2" width="14" height="14" rx="2" stroke="currentColor" stroke-width="2.5" />
            <rect x="24" y="2" width="14" height="14" rx="2" stroke="currentColor" stroke-width="2.5" />
            <rect x="2" y="24" width="14" height="14" rx="2" stroke="currentColor" stroke-width="2.5" />
            <rect x="6" y="6" width="6" height="6" rx="1" fill="currentColor" />
            <rect x="28" y="6" width="6" height="6" rx="1" fill="currentColor" />
            <rect x="6" y="28" width="6" height="6" rx="1" fill="currentColor" />
            <rect x="24" y="24" width="4" height="4" rx="1" fill="currentColor" />
            <rect x="30" y="24" width="4" height="4" rx="1" fill="currentColor" />
            <rect x="24" y="30" width="4" height="4" rx="1" fill="currentColor" />
            <rect x="34" y="30" width="4" height="4" rx="1" fill="currentColor" />
            <rect x="30" y="34" width="4" height="4" rx="1" fill="currentColor" />
          </svg>
          <h1>QR Scan</h1>
        </div>
        <div class="header-right">
          <!-- Staff Badge -->
          <div class="staff-badge" id="staffBadge" style="display:none;" title="Staf aktif">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
              <circle cx="12" cy="7" r="4" />
            </svg>
            <span id="staffBadgeName">—</span>
          </div>
          <!-- Network Status -->
          <div class="network-status" id="networkStatus" title="Online">
            <span class="network-dot online"></span>
            <span class="network-label" id="networkLabel">Online</span>
          </div>
          <button id="themeToggle" class="icon-btn" title="Toggle theme" aria-label="Toggle theme">
            <svg class="icon sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="5" />
              <line x1="12" y1="1" x2="12" y2="3" />
              <line x1="12" y1="21" x2="12" y2="23" />
              <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
              <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
              <line x1="1" y1="12" x2="3" y2="12" />
              <line x1="21" y1="12" x2="23" y2="12" />
              <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
              <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" />
            </svg>
            <svg class="icon moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
            </svg>
          </button>
          <!-- Settings Button -->
          <button id="settingsBtn" class="icon-btn" title="Pengaturan" aria-label="Pengaturan">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="3" />
              <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />
            </svg>
          </button>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Statistics -->
      <section class="stats-section" id="statsSection">
        <div class="stat-card">
          <div class="stat-number" id="statTotal">0</div>
          <div class="stat-label">Total Scan</div>
        </div>
        <div class="stat-card stat-verified">
          <div class="stat-number" id="statVerified">0</div>
          <div class="stat-label">Terverifikasi</div>
        </div>
        <div class="stat-card stat-pending">
          <div class="stat-number" id="statPending">0</div>
          <div class="stat-label">Pending</div>
        </div>
      </section>
      <!-- Scanner Section -->
      <section class="scanner-section glass-card" id="scannerSection">
        <div class="section-header">
          <h2>
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z" />
              <circle cx="12" cy="13" r="4" />
            </svg>
            Scanner
          </h2>
          <div class="scanner-controls">
            <button id="startScanBtn" class="btn btn-primary">
              <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z" />
                <circle cx="12" cy="13" r="4" />
              </svg>
              Mulai Scan
            </button>
            <button id="stopScanBtn" class="btn btn-outline" style="display:none;">
              <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="6" y="6" width="12" height="12" rx="2" />
              </svg>
              Stop
            </button>
          </div>
        </div>
        <!-- Auto-scan toggle -->
        <label class="auto-scan-toggle" id="autoScanToggle">
          <input type="checkbox" id="autoScanCheck" />
          <span class="toggle-slider"></span>
          <span class="toggle-label">Mode Antrian (auto-scan setelah verifikasi)</span>
        </label>
        <div id="scannerContainer" class="scanner-container">
          <div class="scanner-placeholder" id="scannerPlaceholder">
            <svg class="placeholder-icon" viewBox="0 0 80 80" fill="none" stroke="currentColor" stroke-width="1.5">
              <rect x="4" y="4" width="24" height="24" rx="4" />
              <rect x="52" y="4" width="24" height="24" rx="4" />
              <rect x="4" y="52" width="24" height="24" rx="4" />
              <rect x="52" y="52" width="12" height="12" rx="2" />
              <rect x="68" y="52" width="8" height="8" rx="1" />
              <rect x="52" y="68" width="8" height="8" rx="1" />
              <rect x="68" y="68" width="8" height="8" rx="1" />
              <line x1="36" y1="8" x2="44" y2="8" />
              <line x1="40" y1="4" x2="40" y2="12" />
            </svg>
            <p>Tekan <strong>"Mulai Scan"</strong> untuk membuka kamera</p>
            <p class="placeholder-hint">Arahkan kamera ke QR code</p>
          </div>
          <div id="reader" class="scanner-reader"></div>
        </div>
        <!-- Manual ID Input -->
        <div class="manual-input">
          <div class="manual-input-divider">
            <span>atau ketik ID manual</span>
          </div>
          <form id="manualForm" class="manual-form">
            <input type="text" id="manualIdInput" class="manual-input-field" placeholder="Contoh: REG-001"
              autocomplete="off" />
            <button type="submit" class="btn btn-primary manual-submit-btn">
              <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8" />
                <line x1="21" y1="21" x2="16.65" y2="16.65" />
              </svg>
              Cari
            </button>
          </form>
        </div>
      </section>

      <!-- Verification Panel -->
      <section class="verify-section glass-card" id="verifySection" style="display:none;">
        <div class="section-header">
          <h2>
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
              <circle cx="8.5" cy="7" r="4" />
              <polyline points="17 11 19 13 23 9" />
            </svg>
            Data Registrasi
          </h2>
          <button id="closeVerify" class="icon-btn" title="Tutup">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18" />
              <line x1="6" y1="6" x2="18" y2="18" />
            </svg>
          </button>
        </div>

        <!-- Loading State -->
        <div class="verify-loading" id="verifyLoading">
          <div class="loading-spinner"></div>
          <p>Mencari data...</p>
        </div>

        <!-- Error State -->
        <div class="verify-error" id="verifyError" style="display:none;">
          <svg class="icon error-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10" />
            <line x1="15" y1="9" x2="9" y2="15" />
            <line x1="9" y1="9" x2="15" y2="15" />
          </svg>
          <p id="verifyErrorMsg">Data tidak ditemukan</p>
          <button id="retryScanBtn" class="btn btn-primary">Scan Ulang</button>
        </div>

        <!-- Data Display -->
        <div class="verify-data" id="verifyData" style="display:none;">
          <!-- Status Badge -->
          <div class="verify-status" id="verifyStatus">
            <span class="status-badge status-pending" id="statusBadge">
              <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10" />
                <line x1="12" y1="8" x2="12" y2="12" />
                <line x1="12" y1="16" x2="12.01" y2="16" />
              </svg>
              Belum Diverifikasi
            </span>
          </div>

          <!-- Info Cards -->
          <div class="info-grid">
            <div class="info-card">
              <div class="info-label">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                  <circle cx="12" cy="7" r="4" />
                </svg>
                ID
              </div>
              <div class="info-value" id="regId">—</div>
            </div>
            <div class="info-card">
              <div class="info-label">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                  <circle cx="12" cy="7" r="4" />
                </svg>
                Nama Lengkap
              </div>
              <div class="info-value info-value-lg" id="regNama">—</div>
            </div>
            <div class="info-card">
              <div class="info-label">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path
                    d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z" />
                </svg>
                Telepon
              </div>
              <div class="info-value" id="regPhone">—</div>
            </div>
          </div>

          <!-- KTP Preview -->
          <div class="ktp-preview">
            <div class="ktp-label">
              <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                <circle cx="8.5" cy="8.5" r="1.5" />
                <polyline points="21 15 16 10 5 21" />
              </svg>
              KTP / Identitas
            </div>
            <div class="ktp-image-container" id="ktpContainer">
              <img id="ktpImage" class="ktp-image" alt="KTP Preview" />
              <div class="ktp-loading" id="ktpLoading">
                <div class="loading-spinner small"></div>
              </div>
              <button class="ktp-fullscreen-btn" id="ktpFullscreenBtn" title="Lihat penuh">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="15 3 21 3 21 9" />
                  <polyline points="9 21 3 21 3 15" />
                  <line x1="21" y1="3" x2="14" y2="10" />
                  <line x1="3" y1="21" x2="10" y2="14" />
                </svg>
              </button>
            </div>
          </div>

          <!-- Verify Action -->
          <div class="verify-actions" id="verifyActions">
            <button id="verifyBtn" class="btn btn-verify">
              <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                <polyline points="22 4 12 14.01 9 11.01" />
              </svg>
              Verifikasi Sekarang
            </button>
          </div>

          <!-- Already Verified -->
          <div class="already-verified" id="alreadyVerified" style="display:none;">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
              <polyline points="22 4 12 14.01 9 11.01" />
            </svg>
            <span>Sudah diverifikasi</span>
            <span class="verified-time" id="verifiedTime"></span>
          </div>
        </div>
      </section>

      <!-- KTP Fullscreen Modal -->
      <div class="fullscreen-modal" id="ktpModal" style="display:none;">
        <button class="modal-close-btn" id="modalCloseBtn">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18" />
            <line x1="6" y1="6" x2="18" y2="18" />
          </svg>
        </button>
        <img id="ktpModalImage" class="modal-image" alt="KTP Full View" />
      </div>

      <!-- History Section -->
      <section class="history-section glass-card" id="historySection">
        <div class="section-header">
          <h2>
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10" />
              <polyline points="12 6 12 12 16 14" />
            </svg>
            Riwayat Scan
            <span class="history-count" id="historyCount">0</span>
          </h2>
          <button id="clearHistoryBtn" class="btn btn-ghost" title="Hapus semua riwayat">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="3 6 5 6 21 6" />
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
            </svg>
            Hapus Semua
          </button>
        </div>
        <div class="history-list" id="historyList">
          <div class="empty-state" id="emptyHistory">
            <svg class="empty-icon" viewBox="0 0 64 64" fill="none" stroke="currentColor" stroke-width="1.5">
              <rect x="8" y="8" width="48" height="48" rx="8" />
              <line x1="20" y1="24" x2="44" y2="24" />
              <line x1="20" y1="32" x2="38" y2="32" />
              <line x1="20" y1="40" x2="32" y2="40" />
            </svg>
            <p>Belum ada riwayat scan</p>
            <p class="empty-hint">Hasil scan akan muncul di sini</p>
          </div>
        </div>
      </section>
    </main>

    <!-- Toast -->
    <div class="toast" id="toast">
      <span id="toastMessage"></span>
    </div>

    <!-- Lock Screen -->
    <div class="lock-screen" id="lockScreen">
      <div class="lock-card">
        <div class="lock-logo">
          <svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="2" y="2" width="14" height="14" rx="2" stroke="currentColor" stroke-width="2.5" />
            <rect x="24" y="2" width="14" height="14" rx="2" stroke="currentColor" stroke-width="2.5" />
            <rect x="2" y="24" width="14" height="14" rx="2" stroke="currentColor" stroke-width="2.5" />
            <rect x="6" y="6" width="6" height="6" rx="1" fill="currentColor" />
            <rect x="28" y="6" width="6" height="6" rx="1" fill="currentColor" />
            <rect x="6" y="28" width="6" height="6" rx="1" fill="currentColor" />
            <rect x="24" y="24" width="4" height="4" rx="1" fill="currentColor" />
            <rect x="30" y="24" width="4" height="4" rx="1" fill="currentColor" />
            <rect x="24" y="30" width="4" height="4" rx="1" fill="currentColor" />
            <rect x="34" y="30" width="4" height="4" rx="1" fill="currentColor" />
            <rect x="30" y="34" width="4" height="4" rx="1" fill="currentColor" />
          </svg>
          <h2>QR Scan</h2>
        </div>
        <p class="lock-subtitle">Masukkan PIN untuk melanjutkan</p>
        <div class="pin-input-group">
          <input type="password" id="pinInput" class="pin-input" maxlength="6" placeholder="••••" inputmode="numeric" autocomplete="off" />
        </div>
        <div class="lock-error" id="lockError" style="display:none;">PIN salah</div>
        <div class="staff-select-group">
          <label class="staff-select-label">Pilih Nama Staf</label>
          <select id="staffSelect" class="staff-select">
            <option value="">— Pilih staf —</option>
          </select>
        </div>
        <button id="lockUnlockBtn" class="btn btn-primary lock-btn">Masuk</button>
        <p class="lock-hint">Hubungi admin untuk PIN dan akses</p>
      </div>
    </div>

    <!-- Settings Modal -->
    <div class="settings-modal" id="settingsModal" style="display:none;">
      <div class="settings-card">
        <div class="settings-header">
          <h2>
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="3" />
              <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />
            </svg>
            Pengaturan
          </h2>
          <button id="closeSettings" class="icon-btn" title="Tutup">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18" />
              <line x1="6" y1="6" x2="18" y2="18" />
            </svg>
          </button>
        </div>
        <div class="settings-body">
          <!-- Google Sheets URL -->
          <div class="settings-group">
            <label class="settings-label">Google Apps Script URL</label>
            <p class="settings-hint">Paste URL Web App dari Apps Script deployment</p>
            <div class="settings-url-row">
              <input type="url" id="settingsUrl" class="settings-input" placeholder="https://script.google.com/macros/s/..." autocomplete="off" />
              <button id="testConnectionBtn" class="btn btn-outline settings-test-btn">Test</button>
            </div>
            <div class="settings-status" id="settingsUrlStatus"></div>
          </div>
          <!-- PIN -->
          <div class="settings-group">
            <label class="settings-label">PIN Akses</label>
            <p class="settings-hint">PIN yang harus dimasukkan staf sebelum menggunakan app (kosongkan untuk nonaktifkan)</p>
            <input type="text" id="settingsPin" class="settings-input" placeholder="Contoh: 1234" maxlength="6" autocomplete="off" />
          </div>
          <!-- Staff List -->
          <div class="settings-group">
            <label class="settings-label">Daftar Staf</label>
            <p class="settings-hint">Nama staf yang akan muncul di pilihan saat login (satu per baris)</p>
            <textarea id="settingsStaff" class="settings-textarea" rows="5" placeholder="Pak Budi
Bu Ani
Pak Rudi"></textarea>
          </div>
        </div>
        <div class="settings-footer">
          <button id="saveSettingsBtn" class="btn btn-primary">Simpan Pengaturan</button>
        </div>
      </div>
    </div>
  </div>
  <script type="module" src="/src/main.ts"></script>
</body>

</html>